<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; padding: 20px; background-color: #f0f2f5; margin:0; }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        
        h2 { text-align: center; margin-top: 0; font-size: 24px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #555; }
        
        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        input { width: 100%; padding: 15px; margin-top: 8px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 18px; background: #fcfcfc; }
        input:focus { border-color: #00B900; outline: none; background: #fff; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
        button { width: 100%; padding: 18px; border: none; border-radius: 50px; font-size: 20px; color: white; margin-top: 25px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .btn-green { background-color: #06c755; box-shadow: 0 4px 10px rgba(6, 199, 85, 0.3); }
        .btn-pink { background-color: #ff5e57; box-shadow: 0 4px 10px rgba(255, 94, 87, 0.3); }

        /* ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ */
        .summary-img { width: 100%; border-radius: 10px; margin-top: 15px; }
        .stat-box { background: #eef1f5; padding: 15px; border-radius: 10px; margin-top: 10px; text-align: center; }
        .stat-val { font-size: 24px; font-weight: bold; color: #333; }
        
        #status-msg { text-align: center; color: #888; font-size: 14px; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="section-bmi" class="card">
        <h2 style="color: #06c755;">üèãÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å BMI</h2>
        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
        <input type="number" id="weight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 65.5">
        <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
        <input type="number" id="height" placeholder="‡πÄ‡∏ä‡πà‡∏ô 170">
        <button class="btn-green" onclick="sendData('bmi')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å BMI</button>
    </div>

    <div id="section-bp" class="card">
        <h2 style="color: #ff5e57;">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï</h2>
        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>‡∏ï‡∏±‡∏ß‡∏ö‡∏ô (SYS)</label>
                <input type="number" id="sys" placeholder="120">
            </div>
            <div style="flex: 1;">
                <label>‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á (DIA)</label>
                <input type="number" id="dia" placeholder="80">
            </div>
        </div>
        <label>‡∏ä‡∏µ‡∏û‡∏à‡∏£ (Pulse)</label>
        <input type="number" id="pulse" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏ä‡πà‡∏ô 75)">
        <button class="btn-pink" onclick="sendData('bp')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</button>
    </div>

    <div id="section-summary" class="card">
        <h2 style="color: #4a90e2;">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h2>
        
        <img src="https://quickchart.io/chart?c={type:'line',data:{labels:['‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®'],datasets:[{label:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô',data:[120,118,122,121,119],borderColor:'red',fill:false}]}}" class="summary-img">
        
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <div class="stat-box" style="flex: 1;">
                <div>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 7 ‡∏ß‡∏±‡∏ô</div>
                <div class="stat-val" style="color: #ff5e57;">120/80</div>
            </div>
            <div class="stat-box" style="flex: 1;">
                <div>BMI ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                <div class="stat-val" style="color: #06c755;">22.5</div>
            </div>
        </div>
        <p style="text-align: center; color: #888; margin-top: 10px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>
    </div>

    <div id="status-msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

    <script>
        // ==========================================
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà ID ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const LIFF_ID = "2008799065-MIMzWyU2"; 
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxJGgjsvL_2AoVk8d_EI14zLRa2RdiggmCUbK6SFRZjmaIDoxJJ_Kf7lUZziw1DZBT4/exec";
        // ==========================================

        function showSection(id) {
            document.querySelectorAll('.card').forEach(el => el.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                document.getElementById('status-msg').style.display = 'none';
                
                if (!liff.isLoggedIn()) liff.login();

                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏´‡∏ô
                const urlParams = new URLSearchParams(window.location.search);
                const page = urlParams.get('page');

                if (page === 'bp') showSection('section-bp');
                else if (page === 'summary') showSection('section-summary');
                else showSection('section-bmi'); // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

            } catch (err) {
                document.getElementById('status-msg').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err;
            }
        }
        main();

        nt.getElementById('pulse').value;
                

            async function sendData(type) {
    // 1. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Profile ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ô‡πÉ‡∏ä‡πâ
    const profile = await liff.getProfile();
    let data = { userId: profile.userId, type: type };
    
    // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏î‡πâ‡∏á‡πÇ‡∏ä‡∏ß‡πå
    let summaryMessage = "";

    // ==========================================
    // üü¢ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 1: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ BMI
    // ==========================================
    if(type === 'bmi') {
        // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤
        let w = parseFloat(document.getElementById('weight').value);
        let h = parseFloat(document.getElementById('height').value);
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°
        if(!w || !h) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á‡∏Ñ‡∏£‡∏±‡∏ö"); return; }

        data.weight = w;
        data.height = h;

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
        let bmi = w / Math.pow(h/100, 2);
        let status = "‡∏õ‡∏Å‡∏ï‡∏¥";
        if (bmi < 18.5) status = "‡∏ú‡∏≠‡∏°";
        else if (bmi >= 23 && bmi < 25) status = "‡∏ó‡πâ‡∏ß‡∏°";
        else if (bmi >= 25 && bmi < 30) status = "‡∏≠‡πâ‡∏ß‡∏ô";
        else if (bmi >= 30) status = "‡∏≠‡πâ‡∏ß‡∏ô‡∏°‡∏≤‡∏Å";

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        summaryMessage = `üìä ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å BMI\n` +
                         `----------------\n` +
                         `‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${w} kg\n` +
                         `‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á: ${h} cm\n` +
                         `‡∏Ñ‡πà‡∏≤ BMI: ${bmi.toFixed(2)}\n` +
                         `‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: ${status}`;
    } 
    
    // ==========================================
    // üî¥ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 2: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö)
    // ==========================================
    else if(type === 'bp') {
        // ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤
        let sys = parseInt(document.getElementById('sys').value);
        let dia = parseInt(document.getElementById('dia').value);
        let pulse = document.getElementById('pulse').value;

        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡πÑ‡∏´‡∏°
        if(!sys || !dia) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ö"); return; }

        data.sys = sys;
        data.dia = dia;
        data.pulse = pulse;

        // ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ú‡∏• (‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Ñ‡∏£‡πà‡∏≤‡∏ß‡πÜ)
        let bpStatus = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (Normal) üü¢";
        if (sys >= 140 || dia >= 90) bpStatus = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á (High) üî¥";
        else if (sys >= 130 || dia >= 85) bpStatus = "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏™‡∏π‡∏á (Elevated) üü†";
        else if (sys < 90 || dia < 60) bpStatus = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡πà‡∏≥ (Low) üü°";

        // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
        summaryMessage = `‚ù§Ô∏è ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô\n` +
                         `----------------\n` +
                         `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô: ${sys} / ${dia}\n` +
                         `‡∏ä‡∏µ‡∏û‡∏à‡∏£: ${pulse} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ\n` +
                         `‡∏ú‡∏•‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå: ${bpStatus}`;
    }

    // ==========================================
    // üü° ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà 3: ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
    // ==========================================
    document.getElementById('status-msg').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...";
    
    try {
        // ‡∏™‡πà‡∏á‡πÑ‡∏õ Google Sheets (‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÜ)
        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        });

        // ‚úÖ ‡πÄ‡∏î‡πâ‡∏á‡πÇ‡∏ä‡∏ß‡πå‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏ó‡∏±‡∏ô‡∏ó‡∏µ! (‡∏Ñ‡∏ô‡πÑ‡∏Ç‡πâ‡∏ä‡∏≠‡∏ö‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ)
        alert(summaryMessage);
        
        // ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á
        liff.closeWindow();

    } catch (err) {
        alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err);
    }
}
        
    </script>
</body>
</html>