<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; padding: 20px; background-color: #f0f2f5; margin:0; }
        
        /* ‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
        .card { background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; display: none; }
        
        h2 { text-align: center; margin-top: 0; font-size: 24px; }
        label { display: block; margin-top: 15px; font-weight: bold; color: #555; }
        
        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
        input { width: 100%; padding: 15px; margin-top: 8px; border: 1px solid #ddd; border-radius: 12px; box-sizing: border-box; font-size: 18px; background: #fcfcfc; }
        input:focus { border-color: #00B900; outline: none; background: #fff; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
        button { width: 100%; padding: 18px; border: none; border-radius: 50px; font-size: 20px; color: white; margin-top: 25px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .btn-green { background-color: #06c755; box-shadow: 0 4px 10px rgba(6, 199, 85, 0.3); }
        .btn-pink { background-color: #ff5e57; box-shadow: 0 4px 10px rgba(255, 94, 87, 0.3); }

        /* ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏£‡∏∏‡∏õ */
        .summary-img { width: 100%; border-radius: 10px; margin-top: 15px; }
        .stat-box { background: #eef1f5; padding: 15px; border-radius: 10px; margin-top: 10px; text-align: center; }
        .stat-val { font-size: 24px; font-weight: bold; color: #333; }
        
        #status-msg { text-align: center; color: #888; font-size: 14px; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="section-bmi" class="card">
        <h2 style="color: #06c755;">üèãÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å BMI</h2>
        <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å (kg)</label>
        <input type="number" id="weight" placeholder="‡πÄ‡∏ä‡πà‡∏ô 65.5">
        <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á (cm)</label>
        <input type="number" id="height" placeholder="‡πÄ‡∏ä‡πà‡∏ô 170">
        <button class="btn-green" onclick="sendData('bmi')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å BMI</button>
    </div>

    <div id="section-bp" class="card">
        <h2 style="color: #ff5e57;">‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï</h2>
        <div style="display: flex; gap: 10px;">
            <div style="flex: 1;">
                <label>‡∏ï‡∏±‡∏ß‡∏ö‡∏ô (SYS)</label>
                <input type="number" id="sys" placeholder="120">
            </div>
            <div style="flex: 1;">
                <label>‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á (DIA)</label>
                <input type="number" id="dia" placeholder="80">
            </div>
        </div>
        <label>‡∏ä‡∏µ‡∏û‡∏à‡∏£ (Pulse)</label>
        <input type="number" id="pulse" placeholder="‡∏Ñ‡∏£‡∏±‡πâ‡∏á/‡∏ô‡∏≤‡∏ó‡∏µ (‡πÄ‡∏ä‡πà‡∏ô 75)">
        <button class="btn-pink" onclick="sendData('bp')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô</button>
    </div>

    <div id="section-summary" class="card">
        <h2 style="color: #4a90e2;">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û</h2>
        
        <img src="https://quickchart.io/chart?c={type:'line',data:{labels:['‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®'],datasets:[{label:'‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô',data:[120,118,122,121,119],borderColor:'red',fill:false}]}}" class="summary-img">
        
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <div class="stat-box" style="flex: 1;">
                <div>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 7 ‡∏ß‡∏±‡∏ô</div>
                <div class="stat-val" style="color: #ff5e57;">120/80</div>
            </div>
            <div class="stat-box" style="flex: 1;">
                <div>BMI ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                <div class="stat-val" style="color: #06c755;">22.5</div>
            </div>
        </div>
        <p style="text-align: center; color: #888; margin-top: 10px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</p>
    </div>

    <div id="status-msg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>

    <script>
        // ==========================================
        // ‚ö†Ô∏è ‡πÉ‡∏™‡πà ID ‡πÉ‡∏´‡∏°‡πà‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
        const LIFF_ID = "2008799065-MIMzWyU2"; 
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzT8w-VN2j-r5PzByvkC7hKgFlN8zsoGS7YeZ95VcyVaa1snTrRRxJPlY0qaLmXgAmq/exec";
        // ==========================================

        function showSection(id) {
            document.querySelectorAll('.card').forEach(el => el.style.display = 'none');
            document.getElementById(id).style.display = 'block';
        }

        async function main() {
            try {
                await liff.init({ liffId: LIFF_ID });
                document.getElementById('status-msg').style.display = 'none';
                
                if (!liff.isLoggedIn()) liff.login();

                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏î‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏´‡∏ô
                const urlParams = new URLSearchParams(window.location.search);
                const page = urlParams.get('page');

                if (page === 'bp') showSection('section-bp');
                else if (page === 'summary') showSection('section-summary');
                else showSection('section-bmi'); // ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô

            } catch (err) {
                document.getElementById('status-msg').innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err;
            }
        }
        main();

        nt.getElementById('pulse').value;

        async function sendData(type) {
    // 1. ‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ô‡∏Å‡∏î‡∏ã‡πâ‡∏≥
    const allButtons = document.querySelectorAll('button');
    allButtons.forEach(btn => {
        btn.disabled = true;
        btn.style.opacity = "0.6";
        btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
    });

    try {
        const profile = await liff.getProfile();
        let data = { userId: profile.userId, type: type };
        let summaryMessage = "";

        // ==========================================
        // üü¢ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ BMI
        // ==========================================
        if(type === 'bmi') {
            // ‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÑ‡∏ß‡πâ
            let wInput = document.getElementById('weight').value;
            let hInput = document.getElementById('height').value;

            // üõ°Ô∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 1: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏´‡∏°?
            if(wInput === "" || hInput === "") {
                throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å' ‡πÅ‡∏•‡∏∞ '‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á' ‡∏Ñ‡∏£‡∏±‡∏ö");
            }

            let w = parseFloat(wInput);
            let h = parseFloat(hInput);

            // üõ°Ô∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 2: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏´‡∏°? (‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡∏•‡∏ö, ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà 0)
            if(w <= 0 || h <= 0) {
                throw new Error("‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0 ‡∏Ñ‡∏£‡∏±‡∏ö");
            }
            if(h < 50 || h > 300) { // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ (‡∏™‡∏π‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á 50 ‡∏ã‡∏°. ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô 3 ‡πÄ‡∏°‡∏ï‡∏£ ‡∏Ñ‡∏á‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏ô)
                throw new Error("‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á‡∏î‡∏π‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏£‡∏±‡∏ö");
            }

            data.weight = w;
            data.height = h;

            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì BMI
            let bmi = w / Math.pow(h/100, 2);
            let status = "‡∏õ‡∏Å‡∏ï‡∏¥";
            if (bmi < 18.5) status = "‡∏ú‡∏≠‡∏°";
            else if (bmi >= 23 && bmi < 25) status = "‡∏ó‡πâ‡∏ß‡∏°";
            else if (bmi >= 25 && bmi < 30) status = "‡∏≠‡πâ‡∏ß‡∏ô";
            else if (bmi >= 30) status = "‡∏≠‡πâ‡∏ß‡∏ô‡∏°‡∏≤‡∏Å";

            summaryMessage = `üìä BMI ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\nBMI: ${bmi.toFixed(2)}\n‡∏ú‡∏•: ${status}`;
        } 
        
        // ==========================================
        // üî¥ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏´‡∏ô‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô (BP)
        // ==========================================
        else if(type === 'bp') {
            let sysInput = document.getElementById('sys').value;
            let diaInput = document.getElementById('dia').value;
            let pulseInput = document.getElementById('pulse').value;

            // üõ°Ô∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 1: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏´‡∏° (‡∏£‡∏ß‡∏°‡∏ä‡∏µ‡∏û‡∏à‡∏£)
            if(sysInput === "" || diaInput === "" || pulseInput === "") {
                throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ä‡πà‡∏≠‡∏á (‡∏ï‡∏±‡∏ß‡∏ö‡∏ô, ‡∏ï‡∏±‡∏ß‡∏•‡πà‡∏≤‡∏á, ‡∏ä‡∏µ‡∏û‡∏à‡∏£)");
            }

            let sys = parseInt(sysInput);
            let dia = parseInt(diaInput);
            let pulse = parseInt(pulseInput);

            // üõ°Ô∏è ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô 2: ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°
            if(sys <= 0 || dia <= 0 || pulse <= 0) {
                throw new Error("‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏µ‡∏û‡∏à‡∏£ ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô 0 ‡∏´‡∏£‡∏∑‡∏≠‡∏ï‡∏¥‡∏î‡∏•‡∏ö");
            }
            if(sys > 300 || dia > 200) {
                throw new Error("‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà");
            }

            data.sys = sys;
            data.dia = dia;
            data.pulse = pulse;

            let bpStatus = "‡∏õ‡∏Å‡∏ï‡∏¥";
            if (sys >= 140 || dia >= 90) bpStatus = "‡∏™‡∏π‡∏á (‡∏£‡∏∞‡∏ß‡∏±‡∏á)";

            summaryMessage = `‚ù§Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\nBP: ${sys}/${dia}\n‡∏ú‡∏•: ${bpStatus}`;
        }

        // 2. ‡∏ñ‡πâ‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î -> ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        document.getElementById('status-msg').innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...";
        
        await fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(data)
        });

        // 3. ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        alert(summaryMessage);
        liff.closeWindow();

    } catch (err) {
        // ‚ùå ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡∏î‡πà‡∏≤‡∏ô‡πÑ‡∏´‡∏ô ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ô‡∏±‡πâ‡∏ô
        alert("‚ö†Ô∏è " + err.message);
        
        // ‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Å‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ
        allButtons.forEach(btn => {
            btn.disabled = false;
            btn.style.opacity = "1";
            btn.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
        });
        document.getElementById('status-msg').innerText = "";
    }
}
        
    </script>
</body>
</html>